{% extends 'base.html' %}

{% block content %}
<div style="padding: 20px;">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: #00d4ff; margin: 0;">üì¶ Product Inventory</h2>

        <div style="display: flex; gap: 10px;">
            
            <form method="GET" action="" style="display: flex;">
                <input type="text" name="q" placeholder="Search items..." 
                       value="{{ request.GET.q }}"
                       style="padding: 10px; border-radius: 5px 0 0 5px; border: none; outline: none;">
                
                <button type="submit" 
                        style="padding: 10px 15px; background-color: #00d4ff; border: none; border-radius: 0 5px 5px 0; cursor: pointer; font-weight: bold;">
                    üîç
                </button>
            </form>

            {% if user.is_staff or user.is_superuser %}
            <a href="{% url 'add_product' %}" 
               style="background-color: #ffeb3b; color: #1e1e2f; padding: 10px 20px; text-decoration: none; font-weight: bold; border-radius: 5px; display: flex; align-items: center;">
               + Add Product
            </a>
            {% endif %}
            
        </div>
    </div>

    <table border="1" cellpadding="15" style="width: 100%; border-collapse: collapse; color: #fff; border-color: #444;">
        <thead>
            <tr style="background-color: #27293d; color: #00d4ff;">
                <th>Preview</th> <th>Product Name</th>
                <th>Category</th> <th>Quantity</th>
                <th>Price</th>
                <th>Added By</th>
                
                {% if user.is_staff or user.is_superuser %}
                <th style="text-align: center;">Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr style="border-bottom: 1px solid #444; transition: background 0.3s;" onmouseover="this.style.backgroundColor='#333'" onmouseout="this.style.backgroundColor='transparent'">
                
                <td style="text-align: center;">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                             style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px; border: 1px solid var(--accent);">
                    {% else %}
                        <div style="width: 50px; height: 50px; background: #444; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #888;">
                            NO IMG
                        </div>
                    {% endif %}
                </td>

                <td style="font-weight: bold;">{{ product.name }}</td>
                
                <td>
                    <span style="background: rgba(0, 212, 255, 0.1); color: #00d4ff; padding: 4px 8px; border-radius: 4px; font-size: 12px; border: 1px solid rgba(0, 212, 255, 0.3);">
                        {{ product.category.name|default:"Uncategorized" }}
                    </span>
                </td>

                <td>{{ product.quantity }}</td>
                <td style="color: #00ff00;">RM {{ product.price }}</td>
                <td style="color: #aaa;">{{ product.created_by.username }}</td>
                
                {% if user.is_staff or user.is_superuser %}
                <td style="text-align: center;">
                    
                    <a href="{% url 'edit_product' product.id %}" 
                       style="background-color: #ff9f43; color: #1e1e2f; padding: 5px 10px; border-radius: 4px; font-size: 14px; text-decoration: none; margin-right: 5px; font-weight: bold;">
                       Edit
                    </a>

                    {% if user.is_superuser %}
                    <a href="{% url 'delete_product' product.id %}" 
                       style="background-color: #ff5e57; color: white; padding: 5px 10px; border-radius: 4px; font-size: 14px; text-decoration: none; font-weight: bold;"
                       onclick="return confirm('‚ö†Ô∏è Are you sure you want to delete {{ product.name }}?');">
                       Delete
                    </a>
                    {% endif %}

                </td>
                {% endif %}
                
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="text-align: center; color: #aaa; padding: 30px;">
                    No products found in the database.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}